<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesto Assignments</title>
    <style>
        .form-save-file {
            display: flex;
            column-gap: 0.5rem;
        }
    </style>
</head>

<body>
    <main>
        <section>
            <h2>Pesto Assignments</h2>
        </section>
        <section>
            <p>All assignments are hosted using Github pages</p>
        </section>
        <section id="file-list-wrapper">
            <ol id="file-list">
            </ol>
        </section>
        <section>
            <form method="post" onsubmit="saveForm()" class="form-save-file">
                <article>
                    <input id="file-name" onchange="" required />
                </article>
                <article>
                    <input id="file-path" onchange="" required />
                </article>
                <article>
                    <button type="submit">Save</button>
                </article>
            </form>

        </section>
    </main>
</body>
<script>
    const weeks = document.getElementById("file-list")
    const readFile = (file = "") => {



        fetch(file,
            {
                method: "GET",
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/json',
                }
            }
        )
            .then(response => response.json())
            .then(jsonResponse => {
                console.log(jsonResponse);
                return jsonResponse
            }).catch(err => console.error(err))
    }

    const saveFile = (content, filename, contentType = "json") => {
        const a = document.createElement('a');
        const file = new Blob([content], { type: contentType });
        a.href = URL.createObjectURL(file);
        a.download = filename;
        a.click();
        URL.revokeObjectURL(a.href);
    };
    // const fileList = readFile("./json/assignment.json")
    // if (Array.isArray(fileList) && fileList.length) {
    //     const elements = fileList.map(file => `<li>
    //         <a href={file.path}>{file.name}</a>
    //         </li>`)
    // }

    const populateList = () => {
        // CREATE AN XMLHttpRequest OBJECT, WITH GET METHOD.
        file

        var xhr = new XMLHttpRequest(),
            method = 'GET',
            overrideMimeType = 'application/json',
            url = './json/assignments.json';        // ADD THE URL OF THE FILE.

        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {

                const fileList = JSON.parse(xhr.responseText);

                if (Array.isArray(fileList) && fileList.length) {
                    const elements = fileList.map(file => `<li>
                        <a href={file.path}>{file.name}</a>
                        </li>`)
                }

                // let ele = document.getElementById('sel');
                // for (let i = 0; i < birds.length; i++) {
                //     // BIND DATA TO <select> ELEMENT.
                //     ele.innerHTML = ele.innerHTML +
                //         '<option value="' + birds[i].ID + '">' + birds[i].Name + '</option>';
                // }
            }
        };
        xhr.open(method, url, true);
        xhr.send();
    }

    // populateList()
    const saveForm = (a, b, c) => {
        console.log(a, b, c)
    }
    const files = window.requestFileSystem()
    console.log(files)
    readFile("./json/assignment.json")
</script>

</html>